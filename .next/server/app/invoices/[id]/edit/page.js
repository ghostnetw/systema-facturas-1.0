(()=>{var e={};e.id=932,e.ids=[932],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},20585:(e,s,i)=>{Promise.resolve().then(i.bind(i,60377))},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},55433:(e,s,i)=>{Promise.resolve().then(i.bind(i,62563))},60377:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>b});var a=i(45781),r=i(13072),n=i(7439),t=i(5469),d=i(44238),l=i(14784),c=i(14132),o=i(43030),x=i(48414),h=i(84401),u=i(99192),m=i(73583),p=i(41225),j=i(44186),v=i(28328),f=i.n(v),g=i(52127),N=i(8629);function b(){(0,n.useParams)();let e=(0,n.useRouter)(),{clients:s,invoices:i,updateInvoice:v,getInvoiceById:b}=(0,t.U)(),[C,y]=(0,r.useState)(null),[F,P]=(0,r.useState)(!0),[S,A]=(0,r.useState)(null),[w,$]=(0,r.useState)(""),[_,q]=(0,r.useState)(""),[D,E]=(0,r.useState)(""),[I,V]=(0,r.useState)("Pendiente"),[k,R]=(0,r.useState)("transfer"),[B,z]=(0,r.useState)(""),[T,J]=(0,r.useState)([]),[U,Z]=(0,r.useState)(0),[M,G]=(0,r.useState)(0),[L,W]=(0,r.useState)(0),O=e=>{if(T.length>1){let s=T.filter(s=>s.id!==e);J(s),X(s)}},H=(e,s,i)=>{let a=T.map(a=>a.id===e?{...a,[s]:i}:a);J(a),X(a)},X=e=>{let s=e.reduce((e,s)=>e+s.price,0),i=e.reduce((e,s)=>e+s.price*(s.tax/100),0);Z(s),G(i),W(s+i)};return F?(0,a.jsx)(g.b,{children:(0,a.jsx)("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.$,{variant:"outline",size:"icon",asChild:!0,children:(0,a.jsx)(f(),{href:"/invoices",children:(0,a.jsx)(m.A,{className:"h-4 w-4"})})}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Cargando factura..."})]})})}):C?(0,a.jsx)(g.b,{children:(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.$,{variant:"outline",size:"icon",asChild:!0,children:(0,a.jsx)(f(),{href:`/invoices/${C.id}`,children:(0,a.jsx)(m.A,{className:"h-4 w-4"})})}),(0,a.jsxs)("h1",{className:"text-2xl font-bold",children:["Editar Factura ",C.id]})]}),(0,a.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Datos de Facturaci\xf3n"}),(0,a.jsx)(l.BT,{children:"Informaci\xf3n de tu empresa y del cliente"})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Datos de tu empresa"}),(0,a.jsxs)("div",{className:"rounded-md border p-4 bg-gray-50",children:[(0,a.jsx)("p",{className:"font-medium",children:"RESINA ROSARIO, S.L."}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"CIF: B12345678"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Calle Ejemplo, 123"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"28001 Madrid"})]})]}),(0,a.jsx)(h.w,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h3",{className:"text-sm font-medium",children:"Datos del cliente"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"client-select",children:"Seleccionar Cliente"}),(0,a.jsxs)(x.l6,{value:S?.toString(),onValueChange:e=>A(Number(e)),children:[(0,a.jsx)(x.bq,{id:"client-select",children:(0,a.jsx)(x.yv,{placeholder:"Seleccionar cliente"})}),(0,a.jsx)(x.gC,{children:s.map(e=>(0,a.jsxs)(x.eb,{value:e.id.toString(),children:[e.name," - ",e.cif]},e.id))})]})]}),S&&(0,a.jsx)("div",{className:"rounded-md border p-4 bg-gray-50",children:(()=>{let e=s.find(e=>e.id===S);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-medium",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["CIF: ",e.cif]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:e.address}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.postalCode," ",e.city,", ",e.province]})]}):null})()})]})]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Detalles de la Factura"}),(0,a.jsx)(l.BT,{children:"Informaci\xf3n general de la factura"})]}),(0,a.jsxs)(l.Wu,{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"invoice-number",children:"N\xfamero de Factura"}),(0,a.jsx)(c.p,{id:"invoice-number",value:w,disabled:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"invoice-date",children:"Fecha de Emisi\xf3n"}),(0,a.jsx)(c.p,{id:"invoice-date",type:"date",value:_,onChange:e=>q(e.target.value)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"invoice-due-date",children:"Fecha de Vencimiento"}),(0,a.jsx)(c.p,{id:"invoice-due-date",type:"date",value:D,onChange:e=>E(e.target.value)})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"invoice-status",children:"Estado"}),(0,a.jsxs)(x.l6,{value:I,onValueChange:e=>V(e),children:[(0,a.jsx)(x.bq,{id:"invoice-status",children:(0,a.jsx)(x.yv,{placeholder:"Seleccionar estado"})}),(0,a.jsxs)(x.gC,{children:[(0,a.jsx)(x.eb,{value:"Pendiente",children:"Pendiente"}),(0,a.jsx)(x.eb,{value:"Pagada",children:"Pagada"}),(0,a.jsx)(x.eb,{value:"Vencida",children:"Vencida"})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"payment-method",children:"M\xe9todo de Pago"}),(0,a.jsxs)(x.l6,{value:k,onValueChange:R,children:[(0,a.jsx)(x.bq,{id:"payment-method",children:(0,a.jsx)(x.yv,{placeholder:"Seleccionar m\xe9todo"})}),(0,a.jsxs)(x.gC,{children:[(0,a.jsx)(x.eb,{value:"transfer",children:"Transferencia Bancaria"}),(0,a.jsx)(x.eb,{value:"cash",children:"Efectivo"}),(0,a.jsx)(x.eb,{value:"card",children:"Tarjeta de Cr\xe9dito"}),(0,a.jsx)(x.eb,{value:"paypal",children:"PayPal"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o.J,{htmlFor:"invoice-notes",children:"Notas"}),(0,a.jsx)(c.p,{id:"invoice-notes",placeholder:"Notas adicionales para el cliente",value:B,onChange:e=>z(e.target.value)})]})]})]})]}),(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Conceptos"}),(0,a.jsx)(l.BT,{children:"A\xf1ade los servicios o productos a facturar"})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{className:"w-[60%]",children:"Descripci\xf3n"}),(0,a.jsx)(u.nd,{children:"Precio (€)"}),(0,a.jsx)(u.nd,{children:"IVA (%)"}),(0,a.jsx)(u.nd,{children:"Total"}),(0,a.jsx)(u.nd,{})]})}),(0,a.jsx)(u.BF,{children:T.map(e=>(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{children:(0,a.jsx)(c.p,{placeholder:"Descripci\xf3n del servicio o producto",value:e.description,onChange:s=>H(e.id,"description",s.target.value)})}),(0,a.jsx)(u.nA,{children:(0,a.jsx)(c.p,{type:"number",min:"0",step:"0.01",value:e.price,onChange:s=>H(e.id,"price",Number.parseFloat(s.target.value))})}),(0,a.jsx)(u.nA,{children:(0,a.jsxs)(x.l6,{value:e.tax.toString(),onValueChange:s=>H(e.id,"tax",Number.parseInt(s)),children:[(0,a.jsx)(x.bq,{children:(0,a.jsx)(x.yv,{placeholder:"IVA"})}),(0,a.jsxs)(x.gC,{children:[(0,a.jsx)(x.eb,{value:"21",children:"21%"}),(0,a.jsx)(x.eb,{value:"10",children:"10%"}),(0,a.jsx)(x.eb,{value:"4",children:"4%"}),(0,a.jsx)(x.eb,{value:"0",children:"0%"})]})]})}),(0,a.jsxs)(u.nA,{className:"font-medium",children:["€",(e.price*(1+e.tax/100)).toFixed(2)]}),(0,a.jsx)(u.nA,{children:(0,a.jsx)(d.$,{variant:"ghost",size:"icon",onClick:()=>O(e.id),children:(0,a.jsx)(p.A,{className:"h-4 w-4"})})})]},e.id))})]})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)(d.$,{variant:"outline",onClick:()=>{let e={id:T.length>0?Math.max(...T.map(e=>e.id))+1:1,description:"",price:0,tax:21};J([...T,e])},children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4"}),"A\xf1adir Concepto"]})})]}),(0,a.jsxs)(l.wL,{className:"flex justify-between",children:[(0,a.jsx)("div",{}),(0,a.jsxs)("div",{className:"space-y-2 text-right",children:[(0,a.jsxs)("div",{className:"text-sm",children:["Subtotal: ",(0,a.jsxs)("span",{className:"font-medium",children:["€",U.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"text-sm",children:["IVA: ",(0,a.jsxs)("span",{className:"font-medium",children:["€",M.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"text-lg font-bold",children:["Total: €",L.toFixed(2)]})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(d.$,{variant:"outline",asChild:!0,children:(0,a.jsx)(f(),{href:`/invoices/${C.id}`,children:"Cancelar"})}),(0,a.jsx)(d.$,{onClick:()=>{if(!C)return;if(!w||!_||!D||!S||T.some(e=>!e.description)){(0,N.o)({title:"Error",description:"Por favor, completa todos los campos obligatorios.",variant:"destructive"});return}let i=s.find(e=>e.id===S);if(!i)return;let a=e=>{let[s,i,a]=e.split("-");return`${a}/${i}/${s}`},r={...C,client:i.name,cif:i.cif,amount:`€${U.toFixed(2)}`,tax:`€${M.toFixed(2)}`,total:`€${L.toFixed(2)}`,status:I,date:a(_),dueDate:a(D),items:T};v(C.id,r),(0,N.o)({title:"Factura actualizada",description:`La factura ${C.id} ha sido actualizada correctamente.`}),e.push(`/invoices/${C.id}`)},children:"Guardar Cambios"})]})]})}):(0,a.jsx)(g.b,{children:(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-8",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.$,{variant:"outline",size:"icon",asChild:!0,children:(0,a.jsx)(f(),{href:"/invoices",children:(0,a.jsx)(m.A,{className:"h-4 w-4"})})}),(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Factura no encontrada"})]}),(0,a.jsx)(l.Zp,{children:(0,a.jsxs)(l.Wu,{className:"pt-6",children:[(0,a.jsx)("p",{children:"La factura que est\xe1s buscando no existe o ha sido eliminada."}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(d.$,{asChild:!0,children:(0,a.jsx)(f(),{href:"/invoices",children:"Volver a facturas"})})})]})})]})})}},62563:(e,s,i)=>{"use strict";i.r(s),i.d(s,{default:()=>a});let a=(0,i(51129).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\admin\\\\Downloads\\\\facturacion\\\\app\\\\invoices\\\\[id]\\\\edit\\\\page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\admin\\Downloads\\facturacion\\app\\invoices\\[id]\\edit\\page.tsx","default")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},97851:(e,s,i)=>{"use strict";i.r(s),i.d(s,{GlobalError:()=>t.a,__next_app__:()=>x,pages:()=>o,routeModule:()=>h,tree:()=>c});var a=i(7025),r=i(18198),n=i(82576),t=i.n(n),d=i(45239),l={};for(let e in d)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>d[e]);i.d(s,l);let c={children:["",{children:["invoices",{children:["[id]",{children:["edit",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(i.bind(i,62563)),"C:\\Users\\admin\\Downloads\\facturacion\\app\\invoices\\[id]\\edit\\page.tsx"]}]},{}]},{}]},{loading:[()=>Promise.resolve().then(i.bind(i,94361)),"C:\\Users\\admin\\Downloads\\facturacion\\app\\invoices\\loading.tsx"]}]},{layout:[()=>Promise.resolve().then(i.bind(i,59650)),"C:\\Users\\admin\\Downloads\\facturacion\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(i.t.bind(i,4540,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(i.t.bind(i,53117,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(i.t.bind(i,6874,23)),"next/dist/client/components/unauthorized-error"]}]}.children,o=["C:\\Users\\admin\\Downloads\\facturacion\\app\\invoices\\[id]\\edit\\page.tsx"],x={require:i,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.RouteKind.APP_PAGE,page:"/invoices/[id]/edit/page",pathname:"/invoices/[id]/edit",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})}};var s=require("../../../../webpack-runtime.js");s.C(e);var i=e=>s(s.s=e),a=s.X(0,[550,328,735,787,593,436],()=>i(97851));module.exports=a})();